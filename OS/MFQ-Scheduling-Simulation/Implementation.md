# 멀티 레벨 피드백 큐(MFQ) 스케줄링

---

## 코드 구조

1. **데이터 구조**
    - `Process` 구조체: 각 프로세스를 표현하는 구조체.
    - `waitq`, `finishedq`, `global_io_q`: 대기 큐, 완료 큐, 글로벌 I/O 큐.

2. **스케줄러 클래스**
    - `SchedulerBase` (추상 클래스): 스케줄러의 기본 인터페이스 정의.
    - `Scheduler<Container>` (템플릿 클래스): 특정 컨테이너(RR, SRTN, FCFS)를 기반으로 스케줄링을 수행.

3. **함수**
    - `parse_process`: 입력 파일을 파싱하여 프로세스를 생성하고 대기 큐에 삽입.
    - `add_process`: 프로세스를 적절한 큐로 삽입.
    - `process_io_queue`: I/O 큐에서 작업을 수행하고 완료된 프로세스를 다시 실행 큐에 추가.
    - `run`: 전체 스케줄링 시뮬레이션 실행.
    - `print_results`: 최종 결과 출력.
    - `print_queue_status`: 현재 큐 상태 출력.

---

## 코드 동작 방식

### 1. 초기화 단계

1. `parse_process` 함수를 통해 입력 파일에서 프로세스를 읽어 `waitq`에 저장.
2. 프로세스는 도착 시간(`arrival_time`)을 기준으로 정렬됨.

### 2. 실행 단계

`run` 함수의 반복 루프에서 다음 단계가 수행된다:

1. **새로운 프로세스 추가**
    - `waitq`에서 현재 `cpu_clock`과 일치하는 도착 시간이 있는 프로세스를 적절한 우선순위 큐(Q0~Q3)에 추가.

2. **CPU 스케줄링**
    - 우선순위가 높은 큐부터 실행(`Q0 → Q1 → Q2 → Q3`).
    - 스케줄러의 `run` 함수 호출.

3. **스케줄링 알고리즘 적용**
    - **Q0 (RR, TQ=2):**
      - 프로세스가 최대 2개의 타임 퀀텀 동안 실행.
      - 타임 퀀텀 초과 시 `Q1`로 이동.
      - CPU burst가 완료되면 I/O 수행.
    - **Q1 (RR, TQ=6):**
      - 최대 6개의 타임 퀀텀 적용, 초과 시 `Q2`로 이동.
    - **Q2 (SRTN):**
      - 남은 CPU burst 시간이 가장 짧은 프로세스를 우선 실행.
      - 선점될 경우 `Q3`로 이동.
    - **Q3 (FCFS):**
      - 선입선출(FIFO) 방식으로 처리.

4. **I/O 처리**
    - `global_io_q`에서 프로세스를 처리하며, 해당 프로세스의 I/O 시간이 감소.
    - I/O가 완료되면 원래 큐보다 높은 우선순위 큐로 복귀.

5. **프로세스 종료 확인**
    - 모든 CPU burst와 I/O가 완료되면 `finishedq`로 이동.

### 3. 최종 결과 출력

`print_results` 함수를 통해 다음 항목을 출력한다:

- 프로세스의 도착 시간, 종료 시간, 반환 시간(Turnaround Time), 대기 시간(Waiting Time).
- 평균 반환 시간 및 대기 시간.

---

## 실행 과정 예시

### 입력 예시

```txt
3
1 0 0 2 6 3 7
2 1 1 1 8
3 2 2 3 4 3 5 1 4
```

### 출력 예시

```txt
[Scheduling Results]
---------------------------------------------------
  PID |    Arrival |     Finish | Turnaround |   Waiting
---------------------------------------------------
    2 |          1 |         14 |         13 |          5
    1 |          0 |         21 |         21 |          8
    3 |          2 |         34 |         32 |         19
---------------------------------------------------
Average Turnaround Time: 22
Average Waiting Time: 10.6667

```

---

## 주요 설계 고려사항

1. **큐 간 이동 규칙:**
   - CPU burst가 끝나면 I/O 작업을 수행한 후 적절한 큐로 이동.
   - 타임 퀀텀이 만료되면 하위 큐로 이동.
   - SRTN 큐에서는 새로운 프로세스가 들어올 때 선점 발생.

2. **클럭 증가 규칙:**
   - 프로세스가 실행될 때만 `cpu_clock`이 증가하도록 구현.

3. **I/O 처리:**
   - I/O 큐는 별도의 글로벌 큐로 유지되며 프로세스는 일정 시간 후 실행 큐로 돌아옴.

4. **프로세스 완료 처리:**
   - 모든 작업이 완료되면 `finishedq`로 이동하고 완료 시간을 기록.

---
