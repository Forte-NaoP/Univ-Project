# RDT 1.0

---

## 1. 패킷 구조

```
| end_flag (1바이트) | seq_num (1바이트) | payload (최대 1458바이트) |
```

- **end_flag**: 1바이트, 전송할 파일의 마지막 패킷인 경우 0, 그 외에는 1
- **seq_num**: 1바이트, RDT 1.0에서는 모두 같은 값(0)을 사용
- **payload**: 파일에서 읽은 데이터 청크

---

## 2. Receiver (receiver.py)

### 기능

- UDP 소켓을 통해 포트 10090번에서 패킷을 수신한다.
- 수신한 패킷에서 헤더(첫 2바이트)를 제외한 실제 데이터(payload)를 파일에 기록한다.
- `end_flag` 값이 0이면 전송이 완료된 것으로 간주하고 수신 루프를 종료한다.

### 코드 구성

1. **Receiver 클래스:**
   - **생성자:** 파일 이름을 받아 저장합니다.
   - **Context Manager 지원 (`__enter__`/`__exit__`):**  
     - 파일을 바이너리 쓰기 모드로 열고, 작업 종료 시 자동으로 닫는다.
   - **write 메서드:** 전달받은 데이터(payload)를 파일에 기록한다.

2. **메인 실행 부분:**
   - **명령행 인자:** `<result_file> <log_file>` 순서로 입력받으나, RDT 1.0에서는 결과 파일에 기록하는 기능만 구현
   - **UDP 소켓 생성 및 바인딩:**  
     - 소켓을 생성하고, `SO_REUSEADDR` 옵션을 설정한 후 모든 인터페이스(`''`)에서 포트 10090에 바인딩한다.
   - **패킷 수신 및 처리:**  
     - 무한 루프 내에서 `recvfrom(1500)` 호출로 패킷을 받고,  
     - `struct.unpack`을 사용해 첫 번째 바이트(end_flag)를 추출한다.
     - 헤더(앞의 2바이트)를 제외한 나머지 데이터를 파일에 기록한다.
     - `end_flag`가 0이면(즉, 마지막 패킷이면) 루프를 종료한다.

---

## 3. Sender (sender.py)

### 기능
- 지정된 파일을 열어 일정 크기의 데이터 청크로 읽어들임.
- 각 청크에 대해 2바이트 헤더(전송 여부를 나타내는 end_flag와 sequence number)를 추가한 후, UDP 소켓을 통해 전송한다.
- 전송 과정 동안 로그 기록을 수행합니다.

### 코드 구성

1. **Payload 클래스:**
   - **생성자:**  
     - 전송할 파일의 이름과 크기를 저장하고, 초기 시퀀스 번호를 0으로 설정
   - **Context Manager 지원 (`__enter__`/`__exit__`):**  
     - 파일을 바이너리 읽기 모드로 열고, 사용 후 자동으로 닫는다.
   - **get_payload 메서드:**  
     - 파일에서 최대 `MAX_READ_SIZE`만큼 데이터를 읽음
     - 읽은 데이터 청크에 대해 헤더 생성.
       - **end_flag:**  
         - 파일 포인터(`file.tell()`)가 파일 크기와 같으면(즉, 마지막 패킷) 0, 아니면 1로 설정.
       - **seq_num:**  
         - 현재 시퀀스 번호를 1바이트로 패킹
     - 헤더와 청크를 결합하여 하나의 패킷을 구성하고 `yield`로 반환한다.
   - **next_seq_num 메서드 (미사용):**  
     - 시퀀스 번호를 XOR 연산(`^= 1`)을 통해 토글합니다.
     - RDT 1.0에서는 단순 전송만 수행하므로 시퀀스 번호 변경은 필요 없다.

2. **메인 실행 부분:**
   - **명령행 인자:** `<receiver_ip> <window_size> <source_file> <log_file>` 순서로 입력받음
     - 여기서 `window_size`는 RDT 1.0에서 1로 고정되므로 실제로는 사용되지 않는다.
   - **UDP 소켓 생성:**  
     - 소켓을 생성하고 `SO_REUSEADDR` 옵션을 설정합니다.
   - **PASender 모듈 사용:**  
     - `PASender.PASender` 클래스로 소켓을 감싸 전송 기능을 수행한다.
   - **로그 기록:**  
     - `logHandler`를 사용하여 로그 파일을 시작하고, 전송한 각 패킷에 대해 로그를 기록함
     - 각 패킷 전송 시, 현재 시퀀스 번호와 전송 타입(여기서는 SEND_DATA)을 로그에 기록
   - **파일 읽기 및 전송:**  
     - `Payload` 객체를 이용하여 파일을 열고, `get_payload` 메서드를 통해 순차적으로 패킷을 생성한다.
     - 각 패킷을 `sender.sendto_bytes` 메서드를 통해 지정된 Receiver IP와 포트로 전송함
   - **전송 종료 로그:**  
     - 모든 패킷 전송 후 `logger.writeEnd()`를 호출하여 로그 기록을 종료함
     
---